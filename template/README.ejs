<% 
const fs = require('fs');
const path = require('path');

// æ–‡ä»¶å­˜å‚¨è·¯å¾„
const outputDir = 'docs';

// æ¸…ç©º docs ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶
if (fs.existsSync(outputDir)) {
  fs.readdirSync(outputDir).forEach(file => {
    const filePath = path.join(outputDir, file);
    fs.unlinkSync(filePath); // åˆ é™¤æ–‡ä»¶
  });
} else {
  fs.mkdirSync(outputDir); // å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ›å»ºç›®å½•
}

// å­˜å‚¨ README å†…å®¹
let readmeContent = `ğŸ¤© æˆ‘çš„staråˆ—è¡¨ï¼Œ0,8,16è‡ªåŠ¨æ›´æ–° ğŸ¤©
<div>
<img src="https://camo.githubusercontent.com/82291b0fe831bfc6781e07fc5090cbd0a8b912bb8b8d4fec0696c881834f81ac/68747470733a2f2f70726f626f742e6d656469612f394575424971676170492e676966" width="800" height="3">
</div><br>

## Table of Contents\n`;

// å°†æ‰€æœ‰ä»“åº“æŒ‰è¯­è¨€å­˜å‚¨åˆ°ä¸€ä¸ªæ•°ç»„ä¸­
const languageEntries = Array.from(stars);
const languageRepositories = new Map();

// åˆå§‹åŒ–è¯­è¨€å’Œä»“åº“æ•°æ®
languageEntries.forEach(([language, repositories]) => {
  const sortedRepositories = repositories.slice().sort((a, b) => b.stargazers_count - a.stargazers_count);
  languageRepositories.set(language, sortedRepositories);
});

// éå†æ¯ç§è¯­è¨€å¹¶ç”Ÿæˆæ–‡ä»¶å’Œ README å†…å®¹
languageRepositories.forEach((repositories, language) => {
  // ç”Ÿæˆè¯­è¨€æ–‡ä»¶
  const fileName = `${language.replace(/\s+/g, '-').toLowerCase()}.md`;
  const filePath = path.join(outputDir, fileName);
  const fileContent = [
    `## ${language}`,
    ...repositories.map(repo => `- [${repo.full_name}](${repo.html_url}) - ${repo.description || ''}`)
  ].join('\n');

  fs.writeFileSync(filePath, fileContent, 'utf8');

  // æ›´æ–° README å†…å®¹
  readmeContent += `- [${language}](docs/${fileName})\n`;
});

// å†™å…¥ README.md æ–‡ä»¶
fs.writeFileSync('README.md', readmeContent, 'utf8');
%>
